<!--START: BODY_HEADER-->
<section class="breadcrumnb">
  <div class="container">
      <ol itemscope="" itemtype="http://schema.org/BreadcrumbList" class="clearfixfix">
          <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a href="/">[frame_breadcrumb-home]</a></li>
          <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><span>Create/Edit RMA</span></li>
      </ol>
    </div>
</section>
<!--END: BODY_HEADER-->

<section class="page_header">
  <div class="container">
    <h1 class="page_heading">
    <!--START: RMANumber-->
      [rma_header-rmanumber] [RmaNumber]
    <!--END: RMANumber-->
    <!--START: NewRMA-->
      [rma_header-new]
    <!--END: NewRMA-->
    </h1>
    <!--START: myAccount-->
    <div class="button">
        <a href="myaccount.asp" class="icon-btn btn btn-link"> <i class="icon-left"></i> [account_backtomyaccount-text]</a>
    </div>
    <!--END: myAccount-->
    <!--START: CATEGORY_HEADER-->
    <div class="category-header" id="rmaNewhHeader">[CONTENT]</div>
    <!--END: CATEGORY_HEADER-->
  </div>
</section>


<section id="rmaNew" class="page-content">
    <div class="container">
        <div class="content-area">
            <!--START: NEW-->
            <form name="formu" id="formu" method="post" action="" data-parsley-validate="">
                <input type="hidden" name="r" id="r" value="[RmaNumber]" />
                <!--START: form-->
                <div class="viewRma rma-section">
                    <div class="header">
                        <h4 class="page_heading">[rma_header-rmaorderitems]</h4>
                    </div>
                    <div class="rma-titles row hidden-sm hidden-xs">
                        <div class="col-md-3">
                            <label for="rma-id">[rma_header-rmaorder-item-id]</label>
                        </div>
                        <div class="col-md-3">
                            <label for="rma-desc">[rma_header-rmaorder-item-description]</label>
                        </div>
                        <div class="col-md-2 center">
                            <label for="rma-unitprice">[rma_header-rmaorder-item-unitprice]</label>
                        </div>
                        <div class="col-md-2 center">
                            <label for="rma-qty">[rma_header-rmaorder-item-qty]</label>
                        </div>
                        <div class="col-md-2 text">
                            <label for="rma-qtyrtn">[rma_header-rmaorder-item-qtyrtn]</label>
                        </div>
                    </div>
                    <!--START: items-->
                    <div class="row rma-details-row rma-details-lineheight">
                        <div class="col-md-3">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-id">[rma_header-rmaorder-item-id]</label>
                                <div class="col-xs-8 col-md-12">[Id]<input type="hidden" name="Item[idx]" id="Hidden1" value="[IdItem]" /></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-desc">[rma_header-rmaorder-item-description]</label>
                                <div class="col-xs-8 col-md-12">[Description]</div>
                            </div>
                        </div>
                        <div class="col-md-2 center">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-unitprice">[uPrice]</label>
                                <div class="col-xs-8 col-md-12">[uPrice]</div>
                            </div>
                        </div>
                        <div class="col-md-2 center">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-qty">[rma_header-rmaorder-item-qty]</label>
                                <div class="col-xs-8 col-md-12">[Qty]</div>
                            </div>
                        </div>
                        <div class="col-md-2 text">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-qtyrtn">[rma_header-rmaorder-item-qtyrtn]</label>
                                <div class="col-xs-8 col-md-12">
                                    <select name="QR[idx]" id="Select1" class="form-control">
                                        [qr]
                                    </select>
                                    <input type="hidden" name="QRE[idx]" id="Hidden2" value="0" class="item" />
                                    <input type="hidden" name="QRS[idx]" id="Hidden3" value="0" class="item" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--END: items-->
                </div>

                <div class="viewRma viewRmaOption rma-section">
                    <div class="header">
                        <h4 class="page_heading">[rma_header-rmaorder-rtn-option]</h4>
                    </div>
                    <div class="rma-titles row hidden-sm hidden-xs">
                        <div class="col-md-4">
                            <label for="rma-reason">[rma_header-rmaorder-rtn-reason]</label>
                        </div>
                        <div class="col-md-4">
                            <label for="rma-method">[rma_header-rmaorder-rtn-method]</label>
                        </div>
                        <div class="col-md-4">
                            <label for="rma-status">[rma_header-rmaorder-rtn-status]</label>
                        </div>
                    </div>
                    <!--START: options-->
                    <div class="row invoiceTable_details rma-details-row ">
                        <div class="col-md-4">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-reason">[rma_header-rmaorder-rtn-reason]</label>
                                <div class="col-xs-8 col-md-12">
                                    <select name="Reason" id="Select3" class="form-control">
                                        [Reason]
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-method">[rma_header-rmaorder-rtn-status]</label>
                                <div class="col-xs-8 col-md-12">
                                    <select name="Method" id="Select2" class="form-control select-custom">
                                        [Method]
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <label class="visible-xs visible-sm col-xs-4" for="rma-status">[rma_header-rmaorder-rtn-status]</label>
                                <div class="col-xs-8 col-md-12">
                                    Open <input type="hidden" name="Status" id="Hidden4" value="1" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--END: options-->
                </div>

                <div class="viewRma viewRmaOption viewRmaOption-comments rma-section">
                    <div class="header">
                        <h4 class="page_heading">[rma_header-rmacomments]</h4> 
                    </div>
                    <div class="form_data rmaComments">
                        <!--START: comments-->
                        <div class="crmField">
                            <textarea name="comments" id="comments" class="form-control" rows="4" cols="100">[comments]</textarea>
                        </div>
                        <!--END: comments-->

                        <div class="fileattachment_section crmField">
                            <label for="fileupload"><i class="icon-plus"></i> Select files...</label>
                            <div class="clearfix"></div>
                            <span class="fileinput-button">
                                <input id="fileupload" type="file" name="files[]" multiple=""data-url="/filesaction.asp?action=upload&folder=temp&hid=[filehash]">
                            </span>
                            <p></p>
                            <!-- The container for the uploaded files -->
                            <div id="files" class="files-to-upload"></div>
                            <input id="fileattachment" name="fileattachment" type="hidden" />
                            <p id="allelements"></p>
                        </div>
                    </div>
                </div>

                <div class="add-mod-button crmField text-right">
                    <!--START: Mody-->
                    <input type="button" class="btn btn-default" onclick="sendReturn([oid]);" value="[rma_header-rma-btn-returntoorder]" />
                    <!--END: Mody-->
                    <!---START: Add-->
                    <input type="button" class="btn btn-primary rma-cta" onclick="sendReturn(1);" value="[rma_header-rma-btn-saverma]" />
                    <!--END: Add-->
                </div>
                <!--END: form-->
            </form>
            <script type="text/javascript">
              var length, sw, sw2;
              sw = false;
              sw2 = false;

              function evaluate(less) {

                length = ((document.formu.length - less) / 4);

                for (i = 1; i <= length; i++) {
                  if (parseFloat(eval("document.formu.QR" + i + ".value")) > 0) {
                    sw = true;
                    break;
                  }
                  else {
                    sw = false;
                    j = i;
                  }

                }

                return sw;
              }

              function sendReturn(action) {
                if (bUploading) {
                  alert("Please wait for uploading process to complete.");
                  return false;
                }

                var less, i, j;
                j = 0;
                switch (action) {
                  case 1: {
                    less = 6;
                    sw = evaluate(less);
                    break;
                  }
                  case 2: {
                    less = 7;
                    sw = evaluate(less);
                    break;
                  }
                  case 3: {
                    if (confirm("[rma_header-rma-alert-delete]")) sendRMA(length, action);
                    return void (0);
                  }
                  default: {
                    window.location.href = "ordertracking.asp?action=view&id=" + action;
                    return;
                  }
                }
                // if (ExistsCreditCard(jQuery('#comments').val())) {
            
                // valueCard = document.getElementById('comments').value;

                // if (ExistsCreditCard(valueCard)) {
                //   alert("[ccNumerNotAllowedMessage]");
                //   return void (0);
                // }

                if (document.formu.Status.value == 1) {
                  if (sw) {
                    if (confirm("[rma_header-rma-alert-createnew]")) {
                      sendRMA(length, action);
                      return void (0);
                    }
                    else {
                      return void (0);
                    }
                  }
                }

                if (document.formu.Status.value == 3) {
                  sw = evaluate(7);
                  if (sw) {
                    if (confirm("[rma_header-rma-alert-close]")) {
                      sendRMA(length, action);
                      return void (0);
                    }
                    else {
                      return void (0);
                    }
                  }
                }

                if (sw) {
                  sendRMA(length, action);
                  return void (0);
                }
                else {
                  if (j == 0) j = 1;
                  alert("[rma_header-rma-alert-qty]");
                  eval("document.formu.QR1.focus()");
                  return void (0);
                }
              }

              function sendRMA(length, action) {
                document.formu.action = "rma_new.asp?oid=[oid]&op=1&fl=" + length + "&action=" + action;
                document.formu.submit();
              }
            </script>
        <!--END: NEW-->
        <!--START: NOTNEW-->
        <div class="notnewRma">
          [rma_header-cant-create-new-rma]
          <div class="notnew-button">
            <input type="button" class="btn btn-default" onclick="javascript:history.back(1);" value="Go Back"/>
          </div>
        </div>
        <!--END: NOTNEW-->
        <div class="clearfix"></div>
        <!--START: CATEGORY_FOOTER-->
        <div class="category-footer" id="rmaNewFooter">[CONTENT]</div>
        <!--END: CATEGORY_FOOTER-->
      </div>
  </div>
</section>

<!--START: template_scripts-->
<script type="text/javascript">
  // UPLOAD FILE
  var bUploading = false;

  var list = [];
  jQuery(function() {
      jQuery("#fileattachment").val('');

      if (jQuery("#fileattachment").val() != '') {
          if (jQuery("#fileattachment").val().split(",").length >= 4) {
              alert("[crm_filelimit]");
              return false;
          }
      }

      jQuery('#fileupload').fileupload({
          dataType: 'json',
          add: function(e, data) {

              var extn = "",
                  filename = "";
              var intFilesUploaded = 0;

              if (jQuery("#fileattachment").val() != "") {
                  intFilesUploaded = jQuery("#fileattachment").val().split(",").length;
              }

              if (data.originalFiles.length > 4 || (data.originalFiles.length + intFilesUploaded) > 4) {
                  alert("[crm_filelimit]");
                  return false;
              } else {
                  var filename = data.files[0].name;

                  if (filename.lastIndexOf(".") > 0) {
                      extn = filename.substring(filename.lastIndexOf(".") + 1, filename.length);
                      if (extn.toLowerCase() == "gif" || extn.toLowerCase() == "jpg" || extn.toLowerCase() == "jpeg" || extn.toLowerCase() == "png" || extn.toLowerCase() == "bmp" || extn.toLowerCase() == "psd" || extn.toLowerCase() == "tif" || extn.toLowerCase() == "zip" || extn.toLowerCase() == "doc" || extn.toLowerCase() == "docx" || extn.toLowerCase() == "pdf" || extn.toLowerCase() == "rtf") {
                          data.context = jQuery('<p/>').text('[crm_uploading]').appendTo(document.body);
                          data.submit();
                      } else {
                          alert("[crm_fileextensions]");
                      }
                  }
              }

          },
          done: function(e, data) {
              jQuery("#allelements").empty();
              jQuery("#fileattachment").empty();

              jQuery.each(data.result.files, function(index, file) {

                  var filenamewithoutextension = file.uniqueFileName.substr(0, file.uniqueFileName.lastIndexOf('.')) || file.uniqueFileName;

                  var strlink = "<span onclick='deleteFile(\"" + file.uniqueFileName + "\");'><i class='icon-cancel'></i></span>";
                  var strFileDownloadLink = "filesaction.asp?action=download&hid=[filehash]&folder=temp&file=" + file.uniqueFileName + "";
                  jQuery("#files").append('<p id="' + file.uniqueFileName + '"  class="' + filenamewithoutextension + '"  ><a id=' + filenamewithoutextension + ' href= ' + strFileDownloadLink + '>' + file.name + '</a><span class="item-remove" >' + strlink + '</span></p>');

                  list.push(file.uniqueFileName);

              });

              jQuery("#fileattachment").val(list);


          },
          progressall: function(e, data) {
              bUploading = true;
              var progress = parseInt(data.loaded / data.total * 100, 10);
              if (progress >= 100)
                  bUploading = false;

              jQuery('#progress .bar').css(
                  'width',
                  progress + '%'
              );
          },
      });
  });

  function deleteFile(fileName) {
      var delyesno = (confirm("[crm_confirm-delete]"));
      if (delyesno) {
          jQuery.get('filesaction.asp', {
                  action: "delete",
                  file: fileName,
                  hid: '[filehash]',
                  folder: "temp",
                  confirm: true,
                  crmid: 0
              },
              function(result) {
                  try {
                      var msg = result.errorMsg;
                      if (msg != '' && msg != undefined) {
                          alert(msg);
                          return false;
                      }
                  } catch (e) {}
              });

          jQuery('#progress .bar').css(
              'width',
              0 + '%'
          );

          var filenamewithoutextension = fileName.substr(0, fileName.lastIndexOf('.')) || fileName;
          var filenamewithoutextension = filenamewithoutextension.replace('(', '\\(');
          var filenamewithoutextension = filenamewithoutextension.replace(')', '\\)');

          jQuery('.' + filenamewithoutextension).remove();

          list.splice(list.indexOf(fileName), 1);
          jQuery("#fileattachment").val(list);

      }
      return false;
  }
</script>
<script type="text/javascript" src="js/vendor/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="js/jquery.fileupload.js"></script>
<!--END: template_scripts-->

<!--START: template_styles-->
<link rel="stylesheet" href="/assets/templates/common-core/css/rma_new.css" type="text/css" media="screen" />
<!--END: template_styles-->