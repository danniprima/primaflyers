<!--START: BODY_HEADER-->
<section class="breadcrumnb">
    <div class="container">
	    <ol itemscope="" itemtype="http://schema.org/BreadcrumbList" class="clearfix">
	        <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a href="/">[frame_breadcrumb-home]</a></li>
	        <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a href="crm.asp?action=add">[crm_header_view_ticket]</a></li>
	    </ol>
	</div>
</section>
<!--END: BODY_HEADER-->

<section class="page_header">
    <div class="container">
        <h1 class="page_heading">[crm_header_view_ticket]</h1>
	    <!--START: myAccount-->
	    <div class="button">
	        <a href="myaccount.asp" class="icon-btn btn btn-link"> <i class="icon-left"></i> [account_backtomyaccount-text]</a>
	    </div>
	    <!--END: myAccount-->
	    <!--START: CATEGORY_HEADER-->
		<div class="category-header" id="crmHeader">[CONTENT]</div>
		<!--END: CATEGORY_HEADER-->
    </div>
</section>


<section id="crm" class="page-content">
	<div class="container">
    	<div class="content-area">
			<div class="header"><h4 class="page_heading">[subject]</h4></div>
            <div class="crmTicketInfo">
            	<div class="row">
                    <div class="formField col-sm-2_4 col-xs-12">
                        <div class="row">
                            <label class="col-sm-12 col-xs-4" for="crm_status">[crm_status]</label>
                            <div class="col-sm-12 col-xs-8">[status]</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="formField col-sm-2_4 col-xs-12">
                        <div class="row">
                            <label class="col-sm-12 col-xs-4" for="crm_department">[crm_department]</label>
                            <div class="col-sm-12 col-xs-8">[department]</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="formField col-sm-2_4 col-xs-12">
                        <div class="row">
                            <label class="col-sm-12 col-xs-4" for="crm_date-opened">[crm_date-opened]</label>
                            <div class="col-sm-12 col-xs-8">[datentime]</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="formField col-sm-2_4 col-xs-12">
                        <div class="row">
                            <label class="col-sm-12 col-xs-4" for="crm_opened-by">[crm_opened-by]</label>
                            <div class="col-sm-12 col-xs-8">[sender]</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="formField col-sm-2_4 col-xs-12">
                        <div class="row">
                            <label class="col-sm-12 col-xs-4" for="crm_last-action-date">[crm_last-action-date]</label>
                            <div class="col-sm-12 col-xs-8">[lastactiondatentime]</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
					<div class="clearfix"></div>
                </div>
            </div>
            <hr class="divider" />
            <div class="crmTicketStatus">
                <div class="row crm_titles titles2 hidden">
                    <div class="col-md-4 col-sm-4">
                        <label for="crm_user-date">[crm_user-date]</label>
                    </div>
                    <div class="col-md-8 col-sm-8">
                        <label for="crm_message">[crm_message]</label>
                    </div>
                </div>

                <!--START: msgDetail-->
            	<div class="clearfix formField crmMsgDetail">
                    <div class="col-sm-12 col-xs-12">
                        <div class="row">
                            <label class="col-sm-2_4 col-xs-4" for="msg-date">[crm_user-date]</label>
                            <div class="col-sm-9 col-xs-8"><span>[msgSender]</span> (<span>[msgDate]</span>)</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xs-12">
                        <div class="row">
                            <label class="col-sm-2_4 col-xs-4" for="msg-message">[crm_message]</label>
                            <div class="col-sm-9 col-xs-8">[msgMessage]</div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
					<div class="clearfix"></div>
                    <!--START: crmAttachments-->
                    <div class="col-xs-12">
                        <div class="crmFiles row">
                            <label class="col-sm-2_4 col-xs-4" for="message">[crm_attachments]</label>
                            <div class="col-sm-9 col-xs-8">
                            	<div class="row">
                                	<div class="crmcomm col-sm-12 col-xs-12">
                                        <ul class="attachmentlist">
                                            <!--START: crmfiles-->
                                            <li><a href="filesaction.asp?action=download&folder=crm&file=[item-name]&hid=[filehash]"><i class="icon-angle-right"></i>[crmfile-name]</a> </li>
                                            <!--END: crmfiles-->
                                        </ul>
                                    </div>
                                	<div class="staffcomm col-sm-12 col-xs-12">
                                        <ul class="attachmentlist">
                                            <!--START: crmfilesStaff-->
                                            <li><a href="filesaction.asp?action=download&folder=crm&file=[item-name-staff]&hid=[filehash]"><i class="icon-angle-right"></i>[crmfile-name-staff]</a></li>
                                            <!--END: crmfilesStaff-->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <!--END: crmAttachments-->
                </div>
                <!--END: msgDetail-->
            </div>
            <div class="crmTicketInfo form_data">
                <div class="header"><h4 class="page_heading"><!--[crm_update]-->Add Response</h4></div>

                <div class="row">
                    <form method="post" action="crm.asp" id="frmForm" name="frmForm">
                        <input type="hidden" name="mk" value="[mk]" />
                        <input type="hidden" name="replyemail" value="[custemail]" />
                        <input type="hidden" name="id" value="[id]" />
                        <input type="hidden" name="action" value="" />
    
                        <div class="crmField col-lg-12">
							<label for="subject">[crm_subject]:</label>
							<div class="crm-subject">[subject]</div>                            
                            <div class="clearfix"></div>
                        </div>
    
                        <div class="crmField col-lg-12">
                            <label for="reply">[crm_response]:</label>
                            <textarea name="reply" id="reply" class="form-control txtBoxStyle"></textarea>
                            <div class="clearfix"></div>
                        </div>
    
                        <!--START: crmFileAttachments-->
						<div class="crmField col-lg-12">
							<div class="file-attachments-button">
								<span class="btn fileinput-button btn-default">
									<i class="icon-plus"></i>
									<span>Select files...</span>
                                <!-- The file input field used as target for the file upload widget -->
									<input id="fileupload" type="file" name="files[]" multiple="" data-url="/filesaction.asp?action=upload&folder=temp&hid=[filehash]" onclick='fnCountReset();'">
                            </span>
							</div>
                            <p></p>
                
                            <div id="progress">
                                <div class="bar" style="width: 0%;"></div>
                            </div>
                            <!-- The container for the uploaded files -->
                            <div id="files" class="files-to-upload"></div>
                            <input id="fileattachment" name="fileattachment" type="hidden" />
                            <p id="allelements"></p>
                        </div>
                        <!--END: crmFileAttachments-->
                        
                        <div class="clearfix"></div>
                        <!--START: captcha-->
                        <div class="crmField col-lg-12">
                            <label for="ramdomWord">Verification:</label>
                            <div class="clearfix"></div>
                            <div class="captcha">
                                <img src="admin/image_pw.asp" width="148" alt="" />
                                <div class="captcha-text">Type the word above...</div>
                                <input type="text" name="ramdomWord" id="ramdomWord" autocomplete="off" value="" size="25" maxlength="30" tabindex="7" class="txtBoxStyle" required="" />
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <!--END: captcha-->
                        <!--START: recaptcha-->
                        <div class="crmField col-lg-12">
                            <label for="recaptcha_challenge_field">Verification:</label>
                            <div class="clearfix"></div>
                            <div class="recaptcha">
                                <script type="text/javascript">
                                    var RecaptchaOptions = { theme: '[recaptcha_theme]' };
                                </script>
                                <script type="text/javascript" src="//www.google.com/recaptcha/api/challenge?k=[recaptcha_key]"></script>
                                <noscript>
                                    <iframe src="//www.google.com/recaptcha/api/noscript?k=[recaptcha_key]" height="300" width="500" frameborder="0"></iframe><br>
                                    <textarea name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
                                    <input type="hidden" name="recaptcha_response_field" value="manual_challenge">
                                </noscript>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <!--END: recaptcha-->
                        <!--START: recaptcharobot-->
						<div class="crmField col-lg-12">
							<!--START: verificationlabel-->
							<label for="recaptcha_challenge_field">Verification:</label>
							<!--END: verificationlabel-->

							<script type="text/javascript">
                                var onSubmit = function (token) {
                                    if ('[recaptcha_robot_size]' == 'invisible')
                                        submitForm('addreply');
                                }
								var onloadCallback = function () {
								    grecaptcha.render('divRobocop', {
								        'sitekey': '[recaptcha_key]',
								        'theme': '[recaptcha_robot_theme]',
								        'size': '[recaptcha_robot_size]',
								        'type': '[recaptcha_robot_type]',
								        'callback': onSubmit
								    });
								}
							</script>
							<script src="//www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
							<div id="divRobocop"></div>
						</div>
                            
                        <!--END: recaptcharobot-->

                        <div class="clearfix"></div>
                        <div id="divSubmitButton" class="col-lg-12">
							<script>
                                function submitted_onclick() {
                                    if (ValidateForm(frmForm)) {
                                        if ('[recaptcha_robot_size]' == 'invisible')
                                            grecaptcha.execute();
                                        else {
                                            submitForm('addreply');
                                        }
                                    }
                                }
							</script>
                            <button type="button" class="btn btn-default btn-inverse" onclick="return submitted_onclick();">Add Response</button>
                        </div>
                    </form>
                    <div class="clearfix"></div>
                </div>
            </div>  
            <div class="clearfix"></div>
            <!--START: CATEGORY_FOOTER-->
            <div class="category-footer" id="crmFooter">[CONTENT]</div>
            <!--END: CATEGORY_FOOTER-->
      </div>
    </div>
</section>

<!--START: template_styles-->
<link rel="stylesheet" href="/assets/templates/common-core/css/contact_us.css" type="text/css" media="screen" />
<!--END: template_styles-->

<!--START: template_scripts-->
<script type="text/javascript" src="/assets/templates/common-core/lib/utilities.js"></script>
<script type="text/javascript">
	var addReplyClick = 0;
	
	function submitForm(strAction)
	{	    	
		document.frmForm.action.value = strAction;
		document.frmForm.submit();
	}
	function ValidateForm()
	{
		var strMsg = "";
		if (document.frmForm.reply.value.trim() == "")
			strMsg += " - [crm_response] cannot be blank.\n";
		//<!--START: captchascript-->
		if (document.frmForm.ramdomWord.value.trim() == "")
			strMsg += " - Verification word cannot be blank.\n";
		//<!--END: captchascript-->

		if (ExistsCreditCard(jQuery('#reply').val()))
			strMsg += "[ccNumerNotAllowedMessage]";
		
		if (strMsg != ""){
			alert(strMsg);
			return false;
		}
		if (addReplyClick == 0){
			addReplyClick = 1;
			return true;
		}
	}
	String.prototype.trim = function() {
		return this.replace(/^\s+|\s+$/g,"");
	}
	function isValidEmail(str) {

		var at="@"
		var dot="."
		var lat=str.indexOf(at)
		var lstr=str.length
		var ldot=str.indexOf(dot)
		
		if (str.indexOf(at)==-1)
		   return false

		if (str.indexOf(at)==-1 || str.indexOf(at)==0 || str.indexOf(at)==lstr)
		   return false

		if (str.indexOf(dot)==-1 || str.indexOf(dot)==0 || str.indexOf(dot)==lstr)
			return false
	
		 if (str.indexOf(at,(lat+1))!=-1)
			return false

		 if (str.substring(lat-1,lat)==dot || str.substring(lat+1,lat+2)==dot)
			return false

		 if (str.indexOf(dot,(lat+2))==-1)
			return false
		
		 if (str.indexOf(" ")!=-1)
			return false

		 return true					
	}
	
	function showSavedMessage()
	{
		window.setTimeout("alert('[crm_message-request-submitted]');",200);
	}
</script>

<!--START: crmFileAttachments_js-->
<script type="text/javascript" src="js/vendor/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="js/jquery.fileupload.js"></script>
<script type="text/javascript">
	function fnCountReset() {
		intFileCount = 0;
		intFileDeleted = 0;
	}

	var bUploading = false;
	var intFileCount = 0;
	var intFileDeleted = 0;

	var list = [];
	jQuery(function () {
	    jQuery("#fileattachment").val('');


	    jQuery('#fileupload').fileupload({
	        dataType: 'json',
			add: function (e, data) {
				intFileCount = intFileCount + 1;
				var extn = "", filename = "";
	            var intFilesUploaded = 0;

	            if (jQuery("#fileattachment").val() != "") {
	                intFilesUploaded = jQuery("#fileattachment").val().split(",").length;
	            }

				intFileTotal = intFilesUploaded + intFileCount - intFileDeleted
				if (intFileTotal > 4) {
	                alert("[crm_filelimit]");
	                return false;
				}
				else {
	                var filename = data.files[0].name;

	                if (filename.lastIndexOf(".") > 0) {
	                    extn = filename.substring(filename.lastIndexOf(".") + 1, filename.length);
	                    if (extn.toLowerCase() == "gif" || extn.toLowerCase() == "jpg" || extn.toLowerCase() == "jpeg" || extn.toLowerCase() == "png" || extn.toLowerCase() == "bmp" || extn.toLowerCase() == "psd" || extn.toLowerCase() == "tif" || extn.toLowerCase() == "zip" || extn.toLowerCase() == "doc" || extn.toLowerCase() == "docx" || extn.toLowerCase() == "pdf" || extn.toLowerCase() == "rtf") {
							data.context = jQuery('<p/>').text('Uploading...').appendTo(document.body);
	                        data.submit();
						}
						else {
	                        alert("[crm_fileextensions]");
	                    }
	                }
	            }

	        },
			done: function (e, data) {
	            jQuery("#allelements").empty();
	            jQuery("#fileattachment").empty();

				jQuery.each(data.result.files, function (index, file) {

	                var filenamewithoutextension = file.uniqueFileName.substr(0, file.uniqueFileName.lastIndexOf('.')) || file.uniqueFileName;

	                var strlink = "<span onclick='deleteFile(\"" + file.uniqueFileName + "\");'><i class='icon-cancel'></i></span>";
	                var strFileDownloadLink = "filesaction.asp?action=download&hid=[filehash]&folder=temp&file=" + file.uniqueFileName + "";
	                jQuery("#files").append('<p id="' + file.uniqueFileName + '"  class="' + filenamewithoutextension + '"  ><a id=' + filenamewithoutextension + ' href= ' + strFileDownloadLink + '>' + file.name + '</a><span class="item-remove" >' + strlink + '</span></p>');

	                list.push(file.uniqueFileName);

	            });

	            jQuery("#fileattachment").val(list);


	        },
			progressall: function (e, data) {
	            bUploading = true;
	            var progress = parseInt(data.loaded / data.total * 100, 10);
	            if (progress >= 100)
	                bUploading = false;

	            jQuery('#progress .bar').css(
	                'width',
	                progress + '%'
	            );
	        },
	    });
	});

	function deleteFile(fileName) {
	    var delyesno = (confirm("[crm_confirm-delete]"));
	    if (delyesno) {
			jQuery.get('filesaction.asp',
			{
	                action: "delete",
	                file: fileName,
	                hid: '[filehash]',
	                folder: "temp",
	                confirm: true,
	                crmid: 0
	            },
			function (result) {
	                try {
	                    var msg = result.errorMsg;
	                    if (msg != '' && msg != undefined) {
	                        alert(msg);
	                        return false;
	                    }
				}
				catch (e) { }
	            });

	        jQuery('#progress .bar').css(
	            'width',
	            0 + '%'
	        );

	        var filenamewithoutextension = fileName.substr(0, fileName.lastIndexOf('.')) || fileName;
	        var filenamewithoutextension = filenamewithoutextension.replace('(', '\\(');
	        var filenamewithoutextension = filenamewithoutextension.replace(')', '\\)');

	        jQuery('.' + filenamewithoutextension).remove();

	        list.splice(list.indexOf(fileName), 1);
	        jQuery("#fileattachment").val(list);

	    }
	    return false;
	}
</script>
<!--END: crmFileAttachments_js-->  

<!--START: showSavedMessage-->
<script>showSavedMessage();</script>
<!--END: showSavedMessage-->

<!--END: template_scripts-->
